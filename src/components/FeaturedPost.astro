---
import { urlFor } from '../lib/sanity';
import { formatDate } from '../lib/utils';
import type { Post } from '../types';
import { Image } from 'astro:assets';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const imageUrl = post.mainImage?.image ? urlFor(post.mainImage.image).width(800).height(400).url() : null;
const authorName = post.author?.name || 'The Bet Blog Team';
const publishedDate = formatDate(post.publishedAt);
const readingTime = Math.max(1, Math.floor(Math.random() * 8) + 5); // Mock reading time
---

<article class="bg-white dark:bg-gray-900 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 dark:border-gray-700 group">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
    <!-- Image Section -->
    {imageUrl && (
      <div class="aspect-w-16 aspect-h-9 lg:aspect-none bg-gray-200 dark:bg-gray-700">
        <Image 
          src={imageUrl}
          alt={post.mainImage?.alt || post.title}
          class="w-full h-64 lg:h-full object-cover group-hover:scale-105 transition-transform duration-300"
          width={800}
          height={400}
          loading="lazy"
          format="webp"
        />
      </div>
    )}
    
    <!-- Content Section -->
    <div class="p-8 flex flex-col justify-center">
      <!-- Categories -->
      {post.categories && post.categories.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-4">
          {post.categories.slice(0, 3).map((category) => (
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200">
              {category.title}
            </span>
          ))}
        </div>
      )}
      
      <!-- Title -->
      <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white mb-4 line-clamp-3 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
        <a href={`/${post.slug.current}`} class="hover:underline">
          {post.title}
        </a>
      </h2>
      
      <!-- Description -->
      {post.metaDescription && (
        <p class="text-gray-600 dark:text-gray-300 text-lg mb-6 line-clamp-4">
          {post.metaDescription}
        </p>
      )}
      
      <!-- Key Takeaways -->
      {post.keyTakeaways && post.keyTakeaways.length > 0 && (
        <div class="mb-6">
          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Key Takeaways:</div>
          <ul class="space-y-2">
            {post.keyTakeaways.slice(0, 3).map((takeaway) => (
              <li class="flex items-start space-x-3">
                <svg class="w-4 h-4 text-primary-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                <span class="text-sm text-gray-600 dark:text-gray-300">{takeaway}</span>
              </li>
            ))}
          </ul>
        </div>
      )}
      
      <!-- Meta Information -->
      <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-6">
        <div class="flex items-center space-x-4">
          <!-- Author -->
          <div class="flex items-center space-x-3">
            {post.author?.image && (
              <img 
                src={urlFor(post.author.image).width(32).height(32).url()}
                alt={authorName}
                class="w-8 h-8 rounded-full"
                width="32"
                height="32"
              />
            )}
            <div>
              <div class="font-medium text-gray-900 dark:text-white">{authorName}</div>
              <div class="text-xs">{publishedDate}</div>
            </div>
          </div>
        </div>
        
        <!-- Reading Time -->
        <div class="flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>{readingTime} min read</span>
        </div>
      </div>
      
      <!-- CTA Button -->
      <div class="flex items-center space-x-4">
        <a 
          href={`/${post.slug.current}`}
          class="inline-flex items-center px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-lg transition-colors shadow-md hover:shadow-lg"
        >
          Read Article
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
        
        <!-- Social Share -->
        <div class="flex items-center space-x-2">
          <button class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors" aria-label="Share on Twitter">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
          </button>
          <button class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors" aria-label="Share on Facebook">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-4 {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
